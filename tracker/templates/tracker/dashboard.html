<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“Š Gmail Job Tracker Dashboard</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      background-color: #f9fafb;
      color: #333;
      line-height: 1.4;
      font-size: 0.85rem;
    }
    h1 {
      color: #1f2937;
      margin-top: 0.5rem;
      margin-bottom: 0.75rem;
      font-size: 1.5rem;
    }
    h2 {
      color: #1f2937;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    .dashboard-layout {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .sidebar {
      flex: 0 0 220px;
      max-width: 240px;
    }
    .charts-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    /* ...other styles... */
  </style>
</head>
<body>

  <h1>ðŸ“Š Gmail Job Tracker Dashboard</h1>

  <div class="dashboard-layout">
    {% include "tracker/_sidebar.html" %}
    <div class="charts-container">
      <div class="card">
        <h2>Message Ingestion Activity (Last 30 Days)</h2>
        <canvas id="ingestionChart" height="100"></canvas>
      </div>

      <div class="card">
        <h2>Job Search Activity by Type (Last 30 Days)</h2>
        <canvas id="activityChart" height="100"></canvas>
      </div>
    </div>
  </div>

  <!-- âœ… Chart.js integration -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    {% if chart_labels %}
    // Ingestion Stats Chart (Line)
    const ctxIngestion = document.getElementById('ingestionChart').getContext('2d');
    const ingestionChart = new Chart(ctxIngestion, {
      type: 'line',
      data: {
        labels: {{ chart_labels|safe }},
        datasets: [
          {
            label: 'Inserted',
            data: {{ chart_inserted|safe }},
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            fill: true,
            tension: 0.3,
            borderWidth: 2
          },
          {
            label: 'Skipped',
            data: {{ chart_skipped|safe }},
            borderColor: '#f59e0b',
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            fill: true,
            tension: 0.3,
            borderWidth: 2
          },
          {
            label: 'Ignored',
            data: {{ chart_ignored|safe }},
            borderColor: '#ef4444',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            fill: true,
            tension: 0.3,
            borderWidth: 2
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: { 
            position: 'bottom',
            labels: { font: { size: 10 } }
          },
          title: { display: false },
          tooltip: {
            mode: 'index',
            intersect: false,
            bodyFont: { size: 10 }
          }
        },
        scales: {
          x: { 
            display: true,
            ticks: { font: { size: 9 } },
            title: { display: false }
          },
          y: { 
            beginAtZero: true,
            ticks: { font: { size: 9 } },
            title: { display: false }
          }
        }
      }
    });

    // Application Activity Chart (Line)
    const ctxActivity = document.getElementById('activityChart').getContext('2d');
    const activityChart = new Chart(ctxActivity, {
      type: 'line',
      data: {
        labels: {{ chart_labels|safe }},
        datasets: [
          {
            label: 'Applications',
            data: {{ chart_applications|safe }},
            borderColor: '#2563eb',
            backgroundColor: 'rgba(37, 99, 235, 0.1)',
            fill: true,
            tension: 0.3,
            borderWidth: 2
          },
          {
            label: 'Rejections',
            data: {{ chart_rejections|safe }},
            borderColor: '#ef4444',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            fill: true,
            tension: 0.3,
            borderWidth: 2
          },
          {
            label: 'Interviews',
            data: {{ chart_interviews|safe }},
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            fill: true,
            tension: 0.3,
            borderWidth: 2
          },
          {
            label: 'Referrals',
            data: {{ chart_referrals|safe }},
            borderColor: '#8b5cf6',
            backgroundColor: 'rgba(139, 92, 246, 0.1)',
            fill: true,
            tension: 0.3,
            borderWidth: 2
          },
          {
            label: 'Head Hunters',
            data: {{ chart_headhunters|safe }},
            borderColor: '#f59e0b',
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            fill: true,
            tension: 0.3,
            borderWidth: 2
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: { 
            position: 'bottom',
            labels: { font: { size: 10 } }
          },
          title: { display: false },
          tooltip: {
            mode: 'index',
            intersect: false,
            bodyFont: { size: 10 }
          }
        },
        scales: {
          x: { 
            display: true,
            ticks: { font: { size: 9 } },
            title: { display: false }
          },
          y: { 
            beginAtZero: true,
            ticks: { font: { size: 9 } },
            title: { display: false }
          }
        }
      }
    });
    {% endif %}
  </script>

  <script>
    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
    }
  </script>

</body>
</html>